<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pronomen-Sortierung</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&display=swap');

  :root {
    --sky-top:   #1a1a2e;
    --sky-bot:   #16213e;
    --ground:    #0f3460;
    --ground2:   #1a4a7a;
    --card-bg:   rgba(255,255,255,.07);
    --card-bdr:  rgba(255,255,255,.12);
    --text:      #fff;
    --text-dim:  rgba(255,255,255,.55);
    --heart:     #ff4757;

    --c-pers:  #4d96ff;
    --c-refl:  #6bcb77;
    --c-poss:  #ffb347;
    --c-demo:  #c77dff;
    --c-inte:  #ff6b6b;
    --c-rela:  #5ec4d4;
    --c-inde:  #ff9f43;
  }
  * { margin:0; padding:0; box-sizing:border-box; }

  body {
    font-family:'Nunito',sans-serif;
    min-height:100vh;
    background:linear-gradient(180deg, var(--sky-top) 0%, var(--sky-bot) 52%, var(--ground) 52%, var(--ground2) 100%);
    color:var(--text);
    overflow-x:hidden;
    position:relative;
  }

  /* â”€â”€â”€ stars â”€â”€â”€ */
  .stars { position:fixed; inset:0; pointer-events:none; z-index:0; }
  .star { position:absolute; background:#fff; border-radius:50%; animation:twinkle var(--dur) ease-in-out infinite alternate; }
  @keyframes twinkle { to{opacity:.15} }

  /* â”€â”€â”€ clouds â”€â”€â”€ */
  .cloud { position:absolute; background:rgba(255,255,255,.07); border-radius:999px; filter:blur(2px); animation:drift var(--spd) linear infinite; }
  @keyframes drift { from{transform:translateX(-120%)} to{transform:translateX(110vw)} }

  /* â”€â”€â”€ HUD â”€â”€â”€ */
  .hud {
    position:relative; z-index:10;
    display:flex; align-items:center; justify-content:space-between;
    padding:14px 22px;
    background:rgba(0,0,0,.35); backdrop-filter:blur(6px);
  }
  .hud-left { display:flex; align-items:center; gap:18px; }
  .hud-right { display:flex; align-items:center; gap:14px; }
  .streak-badge {
    background:rgba(255,107,107,.18); border:1px solid rgba(255,107,107,.4);
    border-radius:20px; padding:4px 12px;
    font-size:.82rem; font-weight:700; color:#ff6b6b;
    opacity:0; transition:opacity .3s;
  }
  .streak-badge.show { opacity:1; }
  .level-badge {
    font-family:'Fredoka',sans-serif;
    background:linear-gradient(135deg,#ffd93d,#ffb347);
    color:#1a1a2e; border-radius:20px; padding:4px 14px;
    font-size:.9rem; font-weight:600;
  }
  .hearts { display:flex; gap:4px; }
  .heart { font-size:1.3rem; transition:transform .2s; }
  .heart.lost { opacity:.25; transform:scale(.85); }
  .score-num { font-family:'Fredoka',sans-serif; font-size:1.2rem; font-weight:600; color:#ffd93d; }

  /* â”€â”€â”€ back button â”€â”€â”€ */
  .back-btn {
    display:flex; align-items:center; gap:6px;
    background:rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.18);
    border-radius:10px; padding:6px 12px;
    color:rgba(255,255,255,.7); font-size:.82rem; font-weight:700;
    font-family:'Nunito',sans-serif;
    text-decoration:none; cursor:pointer;
    transition:background .2s, border-color .2s, color .2s;
  }
  .back-btn:hover { background:rgba(255,255,255,.15); border-color:rgba(255,255,255,.35); color:#fff; }
  .back-btn:active { transform:scale(.96); }

  /* â”€â”€â”€ main wrap â”€â”€â”€ */
  .game-wrap { position:relative; z-index:5; max-width:780px; margin:22px auto 0; padding:0 16px; }

  /* â”€â”€â”€ chip tray (words to sort) â”€â”€â”€ */
  .tray-card {
    background:var(--card-bg); border:1px solid var(--card-bdr);
    backdrop-filter:blur(8px);
    border-radius:20px; padding:16px 18px;
    margin-bottom:14px;
  }
  .tray-label { font-size:.72rem; text-transform:uppercase; letter-spacing:2px; color:var(--text-dim); margin-bottom:10px; text-align:center; }
  .tray { display:flex; flex-wrap:wrap; justify-content:center; gap:8px; min-height:40px; align-items:center; }

  .chip {
    background:rgba(255,255,255,.1); border:2px solid rgba(255,255,255,.2);
    border-radius:22px; padding:7px 18px;
    font-size:.95rem; font-weight:700; color:#fff;
    cursor:grab; user-select:none;
    transition:transform .15s, box-shadow .2s, border-color .2s, opacity .2s;
    position:relative; z-index:6;
    -webkit-tap-highlight-color:transparent;
  }
  .chip:hover { border-color:rgba(255,255,255,.45); box-shadow:0 3px 14px rgba(0,0,0,.3); transform:translateY(-2px); }
  .chip:active { transform:scale(.95); }
  .chip.dragging { opacity:.45; transform:scale(1.1); cursor:grabbing; box-shadow:0 6px 24px rgba(0,0,0,.4); }
  .chip.selected { border-color:#ffd93d; box-shadow:0 0 0 2px #ffd93d, 0 3px 14px rgba(0,0,0,.3); background:rgba(255,217,61,.12); }
  .chip.placed { opacity:0; pointer-events:none; position:absolute; }   /* hide source once placed */

  /* multi-valid badge */
  .chip .multi-badge {
    position:absolute; top:-7px; right:-7px;
    background:#ffd93d; color:#1a1a2e;
    font-size:.58rem; font-weight:800;
    border-radius:999px; padding:1px 5px;
    line-height:1.3;
  }

  /* â”€â”€â”€ drop zones grid â”€â”€â”€ */
  .zones-grid {
    display:grid;
    grid-template-columns:repeat(auto-fill, minmax(195px,1fr));
    gap:10px;
  }

  .zone {
    background:rgba(255,255,255,.04); border:2px dashed rgba(255,255,255,.18);
    border-radius:18px; padding:12px 10px 10px;
    min-height:108px;
    transition:border-color .25s, background .25s;
    position:relative;
  }
  .zone.drag-over { border-color:rgba(255,255,255,.55); background:rgba(255,255,255,.09); }

  .zone-header { display:flex; align-items:center; gap:8px; margin-bottom:8px; }
  .zone-dot { width:12px; height:12px; border-radius:50%; flex-shrink:0; }
  .zone-title { font-family:'Fredoka',sans-serif; font-size:.78rem; font-weight:600; text-transform:uppercase; letter-spacing:.8px; }
  .zone-icon { font-size:1rem; }

  .zone-chips { display:flex; flex-wrap:wrap; gap:5px; min-height:28px; }

  /* dropped chip inside zone */
  .dchip {
    border-radius:16px; padding:5px 11px;
    font-size:.85rem; font-weight:700;
    border:1.5px solid transparent;
    position:relative; cursor:default;
    transition:transform .15s;
    user-select:none;
  }
  .dchip.correct {
    background:rgba(107,203,119,.18); border-color:#6bcb77; color:#6bcb77;
  }
  .dchip.wrong {
    background:rgba(255,107,107,.18); border-color:#ff6b6b; color:#ff6b6b;
    animation:shake .35s ease;
  }
  .dchip .remove-btn {
    position:absolute; top:-7px; right:-7px;
    width:18px; height:18px; border-radius:50%;
    background:#ff4757; border:2px solid var(--sky-top);
    color:#fff; font-size:.7rem; line-height:14px; text-align:center;
    cursor:pointer; display:none;
    transition:transform .15s;
  }
  .dchip.wrong .remove-btn { display:block; }
  .dchip .remove-btn:hover { transform:scale(1.2); }

  @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }

  /* â”€â”€â”€ feedback float â”€â”€â”€ */
  .feedback {
    position:absolute; top:-14px; left:50%; transform:translateX(-50%);
    font-family:'Fredoka',sans-serif; font-size:1.4rem; font-weight:700;
    pointer-events:none; z-index:20; white-space:nowrap;
    opacity:0; animation:feedUp .7s ease forwards;
  }
  .feedback.good { color:#6bcb77; }
  .feedback.bad  { color:#ff6b6b; }
  @keyframes feedUp { 0%{opacity:1;transform:translate(-50%,0)} 100%{opacity:0;transform:translate(-50%,-38px)} }

  /* â”€â”€â”€ submit / next row â”€â”€â”€ */
  .action-row { text-align:center; margin-top:16px; }
  .btn-submit {
    background:linear-gradient(135deg,#ffd93d,#ffb347); color:#1a1a2e;
    border:none; border-radius:14px; padding:11px 32px;
    font-size:1rem; font-weight:700; font-family:'Nunito',sans-serif;
    cursor:pointer; transition:filter .2s, transform .15s;
    display:none;
  }
  .btn-submit.show { display:inline-block; }
  .btn-submit:hover { filter:brightness(1.1); transform:scale(1.04); }

  /* â”€â”€â”€ info legend toggle â”€â”€â”€ */
  .legend-toggle {
    display:block; margin:12px auto 0;
    background:rgba(255,255,255,.06); border:1px solid var(--card-bdr);
    color:var(--text-dim); border-radius:10px;
    padding:5px 16px; font-size:.78rem; cursor:pointer;
    transition:border-color .2s, color .2s;
  }
  .legend-toggle:hover { border-color:rgba(255,255,255,.3); color:#fff; }
  .legend-box {
    max-width:780px; margin:10px auto 0;
    background:rgba(255,255,255,.06); border:1px solid var(--card-bdr);
    backdrop-filter:blur(6px);
    border-radius:16px; padding:14px 18px;
    display:none; font-size:.82rem; color:var(--text-dim); line-height:1.7;
  }
  .legend-box.open { display:block; }
  .legend-box .leg-row { display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
  .legend-box .leg-dot { width:10px; height:10px; border-radius:50%; flex-shrink:0; }
  .legend-box strong { color:#fff; }

  /* â”€â”€â”€ mascot â”€â”€â”€ */
  .mascot-wrap {
    position:fixed; bottom:12px; right:22px; width:100px; height:120px;
    z-index:4; pointer-events:none;
    animation:bob 2.2s ease-in-out infinite;
  }
  @keyframes bob { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-6px)} }
  .mascot-wrap svg { width:100%; height:100%; }
  .mascot-wrap .eyes-neutral { display:block; }
  .mascot-wrap .eyes-happy,  .mascot-wrap .eyes-sad { display:none; }
  .mascot-wrap.happy .eyes-neutral { display:none; } .mascot-wrap.happy .eyes-happy { display:block; }
  .mascot-wrap.sad   .eyes-neutral { display:none; } .mascot-wrap.sad   .eyes-sad   { display:block; }

  /* â”€â”€â”€ ground trees â”€â”€â”€ */
  .ground-deco { position:fixed; bottom:0; left:0; right:0; height:72px; pointer-events:none; z-index:3; }
  .tree { position:absolute; bottom:0; }

  /* â”€â”€â”€ confetti canvas â”€â”€â”€ */
  #confetti { position:fixed; inset:0; pointer-events:none; z-index:50; }

  /* â”€â”€â”€ overlay (end / round done) â”€â”€â”€ */
  .overlay { position:fixed; inset:0; background:rgba(0,0,0,.7); display:none; align-items:center; justify-content:center; z-index:100; backdrop-filter:blur(4px); }
  .overlay.show { display:flex; }
  .overlay-card {
    background:#1e2235; border:1px solid rgba(255,255,255,.15);
    border-radius:28px; padding:42px 38px; text-align:center;
    max-width:420px; width:90%;
    animation:scaleIn .35s cubic-bezier(.34,1.56,.64,1) both;
  }
  @keyframes scaleIn { from{transform:scale(.8);opacity:0} to{transform:scale(1);opacity:1} }
  .overlay-card h2 { font-family:'Fredoka',sans-serif; font-size:1.9rem; margin-bottom:4px; }
  .overlay-card .big-score { font-family:'Fredoka',sans-serif; font-size:2.8rem; color:#ffd93d; margin:4px 0; }
  .overlay-card p { color:var(--text-dim); margin:6px 0; font-size:.92rem; }
  .overlay-card .btn-restart {
    margin-top:18px; background:linear-gradient(135deg,#ffd93d,#ffb347);
    color:#1a1a2e; border:none; border-radius:14px;
    padding:12px 34px; font-size:1.02rem; font-weight:700;
    font-family:'Nunito',sans-serif; cursor:pointer;
    transition:filter .2s, transform .15s;
  }
  .overlay-card .btn-restart:hover { filter:brightness(1.1); transform:scale(1.04); }

  /* â”€â”€â”€ progress bar â”€â”€â”€ */
  .prog-wrap { max-width:780px; margin:10px auto 0; padding:0 16px; }
  .prog-bg { height:5px; background:rgba(255,255,255,.1); border-radius:99px; overflow:hidden; }
  .prog-fill { height:100%; width:0%; background:linear-gradient(90deg,#6bcb77,#4d96ff); border-radius:99px; transition:width .4s; }

  @media(max-width:520px){
    .zones-grid { grid-template-columns:1fr 1fr; }
    .mascot-wrap { width:74px; height:90px; right:10px; }
  }
</style>
</head>
<body>

<div class="stars" id="stars"></div>
<canvas id="confetti"></canvas>

<!-- HUD -->
<div class="hud">
  <div class="hud-left">
    <a href="index.html" class="back-btn">â† ZurÃ¼ck</a>
    <div class="level-badge" id="levelBadge">Runde 1</div>
    <div class="streak-badge" id="streakBadge">ğŸ”¥ Ã—1</div>
  </div>
  <div class="hud-right">
    <div class="score-num" id="scoreNum">0 Punkte</div>
    <div class="hearts" id="hearts"></div>
  </div>
</div>

<!-- progress -->
<div class="prog-wrap"><div class="prog-bg"><div class="prog-fill" id="progFill"></div></div></div>

<!-- legend toggle -->
<button class="legend-toggle" onclick="document.getElementById('legendBox').classList.toggle('open')">â„¹ï¸ Kategorie-Ãœbersicht</button>
<div class="legend-box" id="legendBox">
  <div class="leg-row"><span class="leg-dot" style="background:var(--c-pers)"></span><strong>Personalpronomen</strong> â€“ ich, du, er, sie, es, wir, ihr + Dativ/Akkusativ</div>
  <div class="leg-row"><span class="leg-dot" style="background:var(--c-refl)"></span><strong>Reflexivpronomen</strong> â€“ sich, einander</div>
  <div class="leg-row"><span class="leg-dot" style="background:var(--c-poss)"></span><strong>Possessivpronomen</strong> â€“ mein, dein, sein, ihr, unser, euer</div>
  <div class="leg-row"><span class="leg-dot" style="background:var(--c-demo)"></span><strong>Demonstrativpronomen</strong> â€“ dieser, jener, derselbe, solcher</div>
  <div class="leg-row"><span class="leg-dot" style="background:var(--c-inte)"></span><strong>Interrogativpronomen</strong> â€“ wer, was, welcher</div>
  <div class="leg-row"><span class="leg-dot" style="background:var(--c-rela)"></span><strong>Relativpronomen</strong> â€“ der, die, das, welcher</div>
  <div class="leg-row"><span class="leg-dot" style="background:var(--c-inde)"></span><strong>Indefinitpronomen</strong> â€“ einige, manche, jemand, nichts â€¦</div>
  <div class="leg-row" style="margin-top:6px;padding-top:6px;border-top:1px solid rgba(255,255,255,.1)">
    <span style="font-size:.76rem;color:rgba(255,255,255,.4)">ğŸ’¡ WÃ¶rter mit einem <strong style="color:#ffd93d">â˜…</strong> passen in mehrere Kategorien â€“ du kannst sie mehrfach nutzen!</span>
  </div>
</div>

<!-- game area -->
<div class="game-wrap">
  <!-- chip tray -->
  <div class="tray-card">
    <div class="tray-label">Ziehe die WÃ¶rter in die richtigen Kategorien</div>
    <div class="tray" id="tray"></div>
  </div>

  <!-- drop zones -->
  <div class="zones-grid" id="zonesGrid"></div>

  <!-- action -->
  <div class="action-row">
    <button class="btn-submit" id="btnSubmit" onclick="checkRound()">âœ“ ÃœberprÃ¼fen</button>
  </div>
</div>

<!-- mascot -->
<div class="mascot-wrap" id="mascot">
  <svg viewBox="0 0 100 120" xmlns="http://www.w3.org/2000/svg">
    <ellipse cx="50" cy="85" rx="28" ry="32" fill="#4d96ff"/>
    <circle cx="50" cy="42" r="26" fill="#4d96ff"/>
    <ellipse cx="30" cy="22" rx="7" ry="11" fill="#3a7bd5" transform="rotate(-15 30 22)"/>
    <ellipse cx="70" cy="22" rx="7" ry="11" fill="#3a7bd5" transform="rotate(15 70 22)"/>
    <ellipse cx="50" cy="48" rx="18" ry="14" fill="#fff" opacity=".15"/>
    <g class="eyes-neutral">
      <circle cx="41" cy="44" r="3.5" fill="#fff"/><circle cx="59" cy="44" r="3.5" fill="#fff"/>
      <circle cx="42" cy="44.5" r="1.8" fill="#1a1a2e"/><circle cx="60" cy="44.5" r="1.8" fill="#1a1a2e"/>
    </g>
    <g class="eyes-happy">
      <path d="M38 43 Q41 40 44 43" stroke="#fff" stroke-width="2.2" fill="none" stroke-linecap="round"/>
      <path d="M56 43 Q59 40 62 43" stroke="#fff" stroke-width="2.2" fill="none" stroke-linecap="round"/>
    </g>
    <g class="eyes-sad">
      <circle cx="41" cy="44" r="3.5" fill="#fff"/><circle cx="59" cy="44" r="3.5" fill="#fff"/>
      <circle cx="41" cy="45" r="1.8" fill="#1a1a2e"/><circle cx="59" cy="45" r="1.8" fill="#1a1a2e"/>
      <path d="M39 52 Q41 50 43 52" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round"/>
      <path d="M57 52 Q59 50 61 52" stroke="#fff" stroke-width="1.5" fill="none" stroke-linecap="round"/>
    </g>
    <path class="mouth-neutral" d="M45 54 Q50 57 55 54" stroke="#fff" stroke-width="1.8" fill="none" stroke-linecap="round" opacity=".7"/>
    <line x1="24" y1="78" x2="10" y2="95" stroke="#3a7bd5" stroke-width="6" stroke-linecap="round"/>
    <line x1="76" y1="78" x2="90" y2="95" stroke="#3a7bd5" stroke-width="6" stroke-linecap="round"/>
    <rect x="38" y="112" width="8" height="10" rx="4" fill="#3a7bd5"/>
    <rect x="54" y="112" width="8" height="10" rx="4" fill="#3a7bd5"/>
  </svg>
</div>

<!-- ground deco -->
<div class="ground-deco">
  <svg class="tree" style="left:5%;width:56px" viewBox="0 0 60 90"><rect class="tree-trunk" x="24" y="55" width="12" height="35" fill="#8B5E3C"/><polygon points="30,0 5,55 55,55" fill="#2d6a4f"/></svg>
  <svg class="tree" style="left:17%;width:40px" viewBox="0 0 60 90"><rect x="24" y="55" width="12" height="35" fill="#8B5E3C"/><polygon points="30,5 8,55 52,55" fill="#2d6a4f"/></svg>
  <svg class="tree" style="right:12%;width:52px" viewBox="0 0 60 90"><rect x="24" y="55" width="12" height="35" fill="#8B5E3C"/><polygon points="30,0 6,55 54,55" fill="#2d6a4f"/></svg>
  <svg class="tree" style="right:27%;width:36px" viewBox="0 0 60 90"><rect x="24" y="55" width="12" height="35" fill="#8B5E3C"/><polygon points="30,8 10,55 50,55" fill="#2d6a4f"/></svg>
</div>

<!-- overlay -->
<div class="overlay" id="overlay">
  <div class="overlay-card">
    <h2 id="overlayTitle">Runde geschafft!</h2>
    <div class="big-score" id="overlayScore">+0</div>
    <p id="overlayMsg"></p>
    <button class="btn-restart" id="overlayBtn" onclick="nextRound()">Weiter â†’</button>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   KATEGORIE-DEFINITIONEN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CATS = [
  { id:'pers', label:'Personalp.',    icon:'ğŸ‘¤', color:'var(--c-pers)' },
  { id:'refl', label:'Reflexivp.',    icon:'ğŸ”„', color:'var(--c-refl)' },
  { id:'poss', label:'Possessivp.',   icon:'ğŸ·ï¸', color:'var(--c-poss)' },
  { id:'demo', label:'Demonstrativp.',icon:'ğŸ‘†', color:'var(--c-demo)' },
  { id:'inte', label:'Interrogativp.',icon:'â“', color:'var(--c-inte)' },
  { id:'rela', label:'Relativp.',     icon:'ğŸ”—', color:'var(--c-rela)' },
  { id:'inde', label:'Indefinitp.',   icon:'ğŸŒ«ï¸', color:'var(--c-inde)' }
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   WORT-DATEN  â€” aus Screenshot 2
   acceptedCats: Array  â†’  mehrere Kategorien wenn nÃ¶tig
   Mehrfach-gÃ¼ltige WÃ¶rter: was, welcher, der, die, das
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ALL_WORDS = [
  // Personalpronomen
  { w:'ich',    cats:['pers'] },
  { w:'du',     cats:['pers'] },
  { w:'wir',    cats:['pers'] },
  { w:'ihr',    cats:['pers','poss'] },   // "ihr" = Personalpronomen UND Possessivpronomen
  { w:'er',     cats:['pers'] },
  { w:'sie',    cats:['pers'] },
  { w:'es',     cats:['pers'] },
  { w:'mir',    cats:['pers'] },
  { w:'dir',    cats:['pers'] },
  { w:'uns',    cats:['pers'] },
  { w:'euch',   cats:['pers'] },
  { w:'ihm',    cats:['pers'] },
  { w:'ihn',    cats:['pers'] },
  { w:'mich',   cats:['pers'] },
  { w:'dich',   cats:['pers'] },
  // Reflexivpronomen
  { w:'sich',   cats:['refl'] },
  { w:'einander', cats:['refl'] },
  // Possessivpronomen
  { w:'mein',   cats:['poss'] },
  { w:'dein',   cats:['poss'] },
  { w:'unser',  cats:['poss'] },
  { w:'euer',   cats:['poss'] },
  { w:'sein',   cats:['poss'] },
  // "ihr" already above
  // Demonstrativpronomen
  { w:'dieser', cats:['demo'] },
  { w:'jener',  cats:['demo'] },
  { w:'derselbe', cats:['demo'] },
  { w:'derjenige', cats:['demo'] },
  { w:'solcher', cats:['demo'] },
  // Interrogativpronomen  â†”  Relativpronomen overlap
  { w:'wer',    cats:['inte'] },
  { w:'was',    cats:['inte','rela'] },          // â˜… multi
  { w:'welcher', cats:['inte','rela'] },         // â˜… multi
  // Relativpronomen
  { w:'der',    cats:['rela','demo'] },          // â˜… multi  (auch Demonstrativ)
  { w:'die',    cats:['rela','demo'] },          // â˜… multi
  { w:'das',    cats:['rela','demo'] },          // â˜… multi
  // Indefinitpronomen
  { w:'einige',       cats:['inde'] },
  { w:'etliche',      cats:['inde'] },
  { w:'manche',       cats:['inde'] },
  { w:'allerlei',     cats:['inde'] },
  { w:'mancherlei',   cats:['inde'] },
  { w:'man',          cats:['inde'] },
  { w:'jedermann',    cats:['inde'] },
  { w:'jemand',       cats:['inde'] },
  { w:'niemand',      cats:['inde'] },
  { w:'nichts',       cats:['inde'] },
  { w:'etwas',        cats:['inde'] },
  { w:'irgendein',    cats:['inde'] },
  { w:'kein',         cats:['inde'] },
  { w:'alle',         cats:['inde'] },
  { w:'beide',       cats:['inde'] },
  { w:'genug',        cats:['inde'] },
];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RUNDEN-AUFBAU  â€” pro Runde ~18 WÃ¶rter, balanciert
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const PER_CAT_ROUND = { pers:4, refl:2, poss:3, demo:3, inte:2, rela:2, inde:4 };
// FÃ¼r multi-WÃ¶rter: sie werden nur EINMAL in den Tray gegeben,
// aber kÃ¶nnen in JEDE akzeptierte Kategorie gelegt werden.

function shuffle(a){ return [...a].sort(()=>Math.random()-.5); }

function buildRound(){
  // Gruppiere nach primÃ¤rer Kategorie (cats[0])
  const byCat = {};
  CATS.forEach(c=>{ byCat[c.id]=[]; });
  ALL_WORDS.forEach(item=>{ byCat[item.cats[0]].push(item); });

  let picked = [];
  CATS.forEach(c=>{
    const n = PER_CAT_ROUND[c.id] || 2;
    const pool = shuffle(byCat[c.id]);
    picked.push(...pool.slice(0, n));
  });
  return shuffle(picked);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const MAX_LIVES = 3;
const TOTAL_ROUNDS = 4;

let lives, score, streak, round, roundData, placements, selectedChipIdx;
// placements: Map<catId, [{chipIdx, word, correct}]>

function initGame(){
  lives  = MAX_LIVES;
  score  = 0;
  streak = 0;
  round  = 1;
  selectedChipIdx = null;
  startRound();
}

function startRound(){
  roundData  = buildRound();
  placements = new Map();
  CATS.forEach(c=> placements.set(c.id, []));
  selectedChipIdx = null;
  renderAll();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RENDER
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderAll(){
  renderTray();
  renderZones();
  renderHud();
  renderProgress();
  document.getElementById('btnSubmit').classList.toggle('show', anyPlaced());
  setMascot('neutral');
}

function renderTray(){
  const tray = document.getElementById('tray');
  tray.innerHTML = '';
  roundData.forEach((item,i)=>{
    if(isChipPlaced(i)) return;         // already in a zone â†’ don't show
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.dataset.idx = i;
    chip.textContent = item.w;
    chip.setAttribute('draggable','true');

    // multi-valid badge
    if(item.cats.length > 1){
      const badge = document.createElement('span');
      badge.className = 'multi-badge';
      badge.textContent = 'â˜…';
      chip.appendChild(badge);
    }

    chip.addEventListener('dragstart', onDragStart);
    chip.addEventListener('dragend',   onDragEnd);
    chip.addEventListener('click',     onChipClick);
    tray.appendChild(chip);
  });
}

function renderZones(){
  const grid = document.getElementById('zonesGrid');
  grid.innerHTML = '';
  CATS.forEach(cat=>{
    const zone = document.createElement('div');
    zone.className = 'zone';
    zone.dataset.catId = cat.id;

    zone.innerHTML = `
      <div class="zone-header">
        <span class="zone-dot" style="background:${cat.color}"></span>
        <span class="zone-icon">${cat.icon}</span>
        <span class="zone-title">${cat.label}</span>
      </div>
      <div class="zone-chips" id="zc-${cat.id}"></div>
    `;

    zone.addEventListener('dragover',  onZoneDragOver);
    zone.addEventListener('dragleave', onZoneDragLeave);
    zone.addEventListener('drop',      onZoneDrop);
    zone.addEventListener('click',     onZoneClick);
    grid.appendChild(zone);

    // populate already-placed chips
    const container = document.getElementById('zc-'+cat.id);
    (placements.get(cat.id)||[]).forEach(p=>{
      const dc = document.createElement('div');
      dc.className = 'dchip ' + (p.correct ? 'correct' : 'wrong');
      dc.dataset.chipIdx = p.chipIdx;
      dc.dataset.catId   = cat.id;
      dc.textContent = p.word;

      // remove btn (only on wrong)
      if(!p.correct){
        const rm = document.createElement('div');
        rm.className = 'remove-btn';
        rm.textContent = 'Ã—';
        rm.addEventListener('click', (e)=>{ e.stopPropagation(); removeChip(p.chipIdx, cat.id); });
        dc.appendChild(rm);
      }
      container.appendChild(dc);
    });
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DRAG & DROP
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let dragIdx = null;

function onDragStart(e){
  dragIdx = +e.currentTarget.dataset.idx;
  e.currentTarget.classList.add('dragging');
  e.dataTransfer.effectAllowed = 'move';
}
function onDragEnd(e){ e.currentTarget.classList.remove('dragging'); }
function onZoneDragOver(e){ e.preventDefault(); e.currentTarget.classList.add('drag-over'); }
function onZoneDragLeave(e){ e.currentTarget.classList.remove('drag-over'); }
function onZoneDrop(e){
  e.preventDefault();
  e.currentTarget.classList.remove('drag-over');
  if(dragIdx === null) return;
  placechip(dragIdx, e.currentTarget.dataset.catId);
  dragIdx = null;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TAP FLOW (mobile)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function onChipClick(e){
  e.stopPropagation();
  const idx = +e.currentTarget.dataset.idx;
  // deselect all
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('selected'));
  if(selectedChipIdx === idx){ selectedChipIdx = null; return; }
  selectedChipIdx = idx;
  e.currentTarget.classList.add('selected');
}
function onZoneClick(e){
  if(selectedChipIdx === null) return;
  placechip(selectedChipIdx, e.currentTarget.dataset.catId);
  document.querySelectorAll('.chip').forEach(c=>c.classList.remove('selected'));
  selectedChipIdx = null;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PLACE / REMOVE CHIP
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function placechip(chipIdx, catId){
  // PrÃ¼fe ob dieses Chip schon in DIESER Kategorie liegt
  const existing = (placements.get(catId)||[]).find(p=> p.chipIdx === chipIdx);
  if(existing) return;

  const item    = roundData[chipIdx];
  const correct = item.cats.includes(catId);

  placements.get(catId).push({ chipIdx, word: item.w, correct });

  if(correct){
    streak++;
    score += 5;
    if(streak >= 3) launchConfetti();
    setMascot('happy');
    showFeedback('+5', 'good');
  } else {
    streak = 0;
    setMascot('sad');
    showFeedback('âœ—', 'bad');
  }

  renderAll();
  updateLevel();
}

function removeChip(chipIdx, catId){
  const arr = placements.get(catId);
  const i   = arr.findIndex(p=> p.chipIdx === chipIdx);
  if(i !== -1) arr.splice(i, 1);
  renderAll();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHECK ROUND  â†’  called when user presses âœ“
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function checkRound(){
  // ZÃ¤hle: wie viele Chips sind richtig platziert, wie viele falsch noch drin
  let wrongCount = 0;
  placements.forEach(arr=> arr.forEach(p=>{ if(!p.correct) wrongCount++; }));

  if(wrongCount > 0){
    // Signalisiere: noch falsche drin
    showFeedback('âš ï¸ Fehler korrigieren!', 'bad');
    setMascot('sad');
    return;
  }

  // PrÃ¼fe ob alle WÃ¶rter mindestens einmal richtig platziert sind
  const placed = new Set();
  placements.forEach(arr=> arr.forEach(p=>{ if(p.correct) placed.add(p.chipIdx); }));
  const missing = roundData.length - placed.size;

  if(missing > 0){
    showFeedback('Noch ' + missing + ' Wort(e) fehlen!', 'bad');
    setMascot('sad');
    return;
  }

  // â”€â”€ Runde erfolgreich â”€â”€ 
  lives = MAX_LIVES;  // Leben zurÃ¼cksetzen pro Runde? â†’ nein, bleiben
  const bonus = 20;
  score += bonus;
  streak = 0;
  launchConfetti();
  setMascot('happy');

  // Overlay
  document.getElementById('overlayTitle').textContent = round < TOTAL_ROUNDS ? 'ğŸ‰ Runde geschafft!' : 'ğŸ† Spiel gewonnen!';
  document.getElementById('overlayScore').textContent  = '+' + bonus + ' Bonus';
  document.getElementById('overlayMsg').textContent    = round < TOTAL_ROUNDS
    ? 'Du geht zur nÃ¤chsten Runde!'
    : 'Du hast alle ' + TOTAL_ROUNDS + ' Runden bestandenein â€“ Herzlichen GlÃ¼ckwunsch!';
  document.getElementById('overlayBtn').textContent    = round < TOTAL_ROUNDS ? 'NÃ¤chste Runde â†’' : 'Noch einmal ğŸ®';
  document.getElementById('overlayBtn').onclick        = round < TOTAL_ROUNDS ? nextRound : restartGame;
  document.getElementById('overlay').classList.add('show');
  renderHud();
}

function nextRound(){
  document.getElementById('overlay').classList.remove('show');
  round++;
  startRound();
}

function restartGame(){
  document.getElementById('overlay').classList.remove('show');
  initGame();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function isChipPlaced(chipIdx){
  // Ein Chip ist "aus dem Tray raus" wenn er in MINDESTENS einer Kategorie liegt
  // UND entweder korrekt ist ODER noch falsch drin. FÃ¼r multi-valid:
  // Wenn er in einer korrekten Kategorie liegt â†’ aus dem Tray
  // Wenn nur in falscher â†’ auch aus dem Tray (kann aber korrigiert werden)
  let found = false;
  placements.forEach(arr=>{
    if(arr.find(p=> p.chipIdx === chipIdx)) found = true;
  });
  return found;
}

function anyPlaced(){
  let any = false;
  placements.forEach(arr=>{ if(arr.length) any=true; });
  return any;
}

function updateLevel(){
  // Nicht nÃ¶tig hier, Runden Ã¼bernehmen die Struktur
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HUD & PROGRESS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderHud(){
  document.getElementById('scoreNum').textContent  = score + ' Punkte';
  document.getElementById('levelBadge').textContent= 'Runde ' + round + ' / ' + TOTAL_ROUNDS;

  const hc = document.getElementById('hearts');
  hc.innerHTML = '';
  for(let i=0;i<MAX_LIVES;i++){
    const h = document.createElement('span');
    h.className = 'heart' + (i >= lives ? ' lost' : '');
    h.textContent = 'â¤ï¸';
    hc.appendChild(h);
  }

  const sb = document.getElementById('streakBadge');
  if(streak >= 2){ sb.textContent='ğŸ”¥ Ã—'+streak; sb.classList.add('show'); }
  else sb.classList.remove('show');
}

function renderProgress(){
  // Wie viele Chips sind korrekt platziert?
  let correct = 0;
  placements.forEach(arr=> arr.forEach(p=>{ if(p.correct) correct++; }));
  // Ziel: jedes Wort mindestens einmal richtig
  const uniqueCorrect = new Set();
  placements.forEach(arr=> arr.forEach(p=>{ if(p.correct) uniqueCorrect.add(p.chipIdx); }));
  const pct = roundData.length ? (uniqueCorrect.size / roundData.length * 100) : 0;
  document.getElementById('progFill').style.width = pct + '%';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MASCOT & FEEDBACK
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function setMascot(state){
  const m = document.getElementById('mascot');
  m.classList.remove('happy','sad');
  if(state !== 'neutral') m.classList.add(state);
}

function showFeedback(txt, cls){
  const card = document.querySelector('.tray-card');
  const fb = document.createElement('div');
  fb.className = 'feedback ' + cls;
  fb.textContent = txt;
  card.style.position = 'relative';
  card.appendChild(fb);
  setTimeout(()=> fb.remove(), 800);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFETTI  (identical to game 2)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function(){
  const canvas = document.getElementById('confetti');
  const ctx = canvas.getContext('2d');
  let particles = [], animId = null;
  function resize(){ canvas.width=innerWidth; canvas.height=innerHeight; }
  addEventListener('resize', resize); resize();

  class P {
    constructor(){
      this.x=canvas.width*Math.random(); this.y=-12;
      this.vx=(Math.random()-.5)*6; this.vy=Math.random()*4+2;
      this.color=['#ff6b6b','#ffd93d','#6bcb77','#4d96ff','#c77dff','#ff9f43'][~~(Math.random()*6)];
      this.sz=Math.random()*6+4; this.spin=Math.random()*Math.PI*2;
      this.spinV=(Math.random()-.5)*.4; this.life=1;
    }
    update(){ this.x+=this.vx; this.y+=this.vy; this.vy+=.08; this.spin+=this.spinV; this.life-=.015; }
    draw(){
      ctx.save(); ctx.translate(this.x,this.y); ctx.rotate(this.spin);
      ctx.globalAlpha=this.life; ctx.fillStyle=this.color;
      ctx.fillRect(-this.sz/2,-this.sz/3,this.sz,this.sz*.6); ctx.restore();
    }
  }
  function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    particles=particles.filter(p=>p.life>0);
    particles.forEach(p=>{ p.update(); p.draw(); });
    if(particles.length) animId=requestAnimationFrame(loop); else animId=null;
  }
  window.launchConfetti = function(){ for(let i=0;i<55;i++) particles.push(new P()); if(!animId) loop(); };
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AMBIENT  (stars + clouds)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
(function(){
  const sc = document.getElementById('stars');
  for(let i=0;i<65;i++){
    const s = document.createElement('div'); s.className='star';
    const sz = Math.random()*2.4+1;
    s.style.cssText=`width:${sz}px;height:${sz}px;top:${Math.random()*48}%;left:${Math.random()*100}%;opacity:${Math.random()*.7+.25};--dur:${Math.random()*2+1.6}s`;
    sc.appendChild(s);
  }
  for(let i=0;i<4;i++){
    const c = document.createElement('div'); c.className='cloud';
    const h = Math.random()*55+28;
    c.style.cssText=`top:${Math.random()*38+4}%;height:${h}px;width:${h*2.7}px;--spd:${Math.random()*28+24}s;animation-delay:-${Math.random()*18}s`;
    document.body.appendChild(c);
  }
})();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INIT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
initGame();
</script>
</body>
</html>
